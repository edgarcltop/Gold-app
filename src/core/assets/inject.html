 <!-- Code injected by live-server -->
 <script src="https://cdn.jsdelivr.net/gh/fiduswriter/diffDOM@4.1.3/browser/diffDOM.js"></script>
 <script type="text/javascript">
   // <![CDATA[  <-- For SVG support

   const { nodeToObj, stringToObj, DiffDOM } = diffDOM;
   const dd = new DiffDOM({});

   (function() {
     window.addEventListener('DOMContentLoaded', () => {
       if (!('WebSocket' in window)) {
         return console.error(
           'Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.'
         );
       }

       window.__last__dom__ = window.document.body;

       const socket = new WebSocket(address);
       socket.onmessage = function(msg) {
         const res = JSON.parse(msg.data);
         if (res.action == 'reload') {
           if (!res.data) return window.location.reload();
           if (!isSameUrl(res.data.fileName, location.pathname)) {
             return;
           }
           if (res.data.dom) replaceDOM(res.data.dom);
         } else if (res.action == 'refreshcss') {
           refreshCSS();
         }
       };
       if (
         sessionStorage &&
         !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer++')
       ) {
         console.log('Live reload enabled.');
         sessionStorage.setItem(
           'IsThisFirstTime_Log_From_LiveServer++',
           true
         );
       }
     });

     function replaceDOM(content) {
       for (let i = 0; i < 2; i++) content = content.replace('<body>*>');

       const pattern = /<body>*>((.|[\n\r])*)<\/body>/im; // https://stackoverflow.com/a/3642850/6120338
       let body = pattern.exec(content)[0];

       const diff = dd.diff(document.body, body);

       const result = dd.apply(document.body, diff);
     }

     function isSameUrl(url1, url2) {
       if (!url1 || url1 === '/') url1 = 'index.html';
       if (!url2 || url2 === '/') url2 = 'index.html';

       if (url1.startsWith('/')) url1 = url1.substr(1);
       if (url2.startsWith('/')) url2 = url2.substr(1);

       return url1 === url2;
     }

     function refreshCSS() {
       var sheets = [].slice.call(document.getElementsByTagName('link'));
       var head = document.getElementsByTagName('head')[0];
       for (var i = 0; i < sheets.length; ++i) {
         var elem = sheets[i];
         var parent = elem.parentElement || head;
         parent.removeChild(elem);
         var rel = elem.rel;
         if (
           (elem.href && typeof rel != 'string') ||
           rel.length == 0 ||
           rel.toLowerCase() == 'stylesheet'
         ) {
           var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
           elem.href =
             url +
             (url.indexOf('?') >= 0 ? '&' : '?') +
             '_cacheOverride=' +
             new Date().valueOf();
         }
         parent.appendChild(elem);
       }
     }

     var protocol =
       window.location.protocol === 'http:' ? 'ws://' : 'wss://';
     var address = protocol + window.location.host + '/_ws';
   })();

   // ]]>
 </script>